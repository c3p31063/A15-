<!-- Path: django/core/templates/core/text_check.html -->
{% extends "core/base.html" %}
{% block title %}ãƒ†ã‚­ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ - A15{% endblock %}

{% block content %}
<div class="card">
  <h1>ãƒ†ã‚­ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯</h1>
  <p class="muted mt-2">
    ç”ŸæˆAIã§ä½œæˆã—ãŸæ–‡ç« ã‚„ã€å¤–éƒ¨ã‚µã‚¤ãƒˆã®è¨˜äº‹ãªã©ã€Œè‘—ä½œæ¨©ãƒªã‚¹ã‚¯ãŒæ°—ã«ãªã‚‹ãƒ†ã‚­ã‚¹ãƒˆã€ã‚’è²¼ã‚Šä»˜ã‘ã¦ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
  </p>

  <form method="post" class="mt-3">
    {% csrf_token %}

    <div class="mb-3">
      <label for="id_input_text">ãƒã‚§ãƒƒã‚¯å¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆ</label>
      <textarea
        id="id_input_text"
        name="input_text"
        rows="8"
        class="form-control"
        placeholder="ã“ã“ã«ãƒã‚§ãƒƒã‚¯ã—ãŸã„ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„"
        required
      >{{ form.input_text.value|default_if_none:"" }}</textarea>
      <div class="form-text">
        â€» æœ€å¤§æ–‡å­—æ•°ãªã©ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã®åˆ¶é™ã«ä¾å­˜ã—ã¾ã™ã€‚
      </div>
    </div>

    <div class="mb-3">
      <label for="id_memo">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
      <input
        id="id_memo"
        type="text"
        name="memo"
        class="form-control"
        placeholder="ã“ã®ãƒã‚§ãƒƒã‚¯ã®ç›®çš„ã‚„æ¡ˆä»¶åãªã©ï¼ˆä»»æ„ï¼‰"
        value="{{ form.memo.value|default_if_none:"" }}"
      />
    </div>

    <div class="mt-3 d-flex justify-content-between align-items-center">
      <button type="submit" class="btn btn-primary">
        ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
      </button>
      <span class="text-muted small">
        â€» å®Ÿè¡Œã™ã‚‹ã¨ FastAPI ã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã€çµæœã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
      </span>
    </div>
  </form>
</div>

{% if result %}
  <div class="card mt-4">
    <h2>ãƒã‚§ãƒƒã‚¯çµæœ</h2>

    <p class="mt-2">
      <strong>ç·åˆãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢:</strong>
      {{ result.risk_score|default_if_none:"-"|floatformat:1 }} / 100
    </p>

    <p>
      <strong>ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«:</strong>
      {% if result.risk_level == "é«˜" %}
        ğŸ”´ é«˜ï¼ˆè¦æ³¨æ„ï¼‰
      {% elif result.risk_level == "ä¸­" %}
        ğŸŸ¡ ä¸­ï¼ˆè¦ç¢ºèªï¼‰
      {% elif result.risk_level == "ä½" %}
        ğŸŸ¢ ä½ï¼ˆå•é¡Œå°ï¼‰
      {% else %}
        {{ result.risk_level|default:"-" }}
      {% endif %}
    </p>

    {% with factors=result.risk_factors %}
      {% if factors %}
        <h3 class="mt-3">ã‚¹ã‚³ã‚¢å†…è¨³</h3>
        <table class="table mt-2">
          <tbody>
            <tr>
              <th>ç›—ç”¨ãƒ»é¡ä¼¼åº¦ï¼ˆæœ€å¤§ï¼‰</th>
              <td>
                {{ factors.plagiarism_max_similarity|default_if_none:"-"|floatformat:1 }} / 100
              </td>
            </tr>
            <tr>
              <th>AI ç”Ÿæˆã‚‰ã—ã•</th>
              <td>
                {{ factors.ai_likeness|default_if_none:"-"|floatformat:1 }} / 100
              </td>
            </tr>
            <tr>
              <th>ä¸é©åˆ‡è¡¨ç¾ã‚¹ã‚³ã‚¢</th>
              <td>
                {{ factors.moderation_score|default_if_none:"-"|floatformat:1 }} / 100
              </td>
            </tr>
            <tr>
              <th>æ‰‹å‹•èª¿æ•´</th>
              <td>
                {{ factors.manual_adjustment|default_if_none:"-"|floatformat:1 }}
              </td>
            </tr>
          </tbody>
        </table>
      {% endif %}
    {% endwith %}

    {% if warnings %}
      <div class="alert alert-warning mt-3" role="alert">
        <strong>è­¦å‘Š / æ³¨æ„äº‹é …:</strong>
        <ul class="mb-0">
          {% for w in warnings %}
            <li>{{ w }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>

  <div class="card mt-4">
    <h2>è©³ç´°æƒ…å ±</h2>

    <h3 class="mt-3">å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ</h3>
    <pre style="white-space: pre-wrap; word-break: break-all;">{{ result.text }}</pre>

    <h3 class="mt-4">ç›—ç”¨ãƒ»é¡ä¼¼ãƒã‚§ãƒƒã‚¯çµæœ</h3>
    {% if result.plagiarism_matches %}
      <table class="table mt-2">
        <thead>
          <tr>
            <th>é¡ä¼¼åº¦</th>
            <th>ã‚¿ã‚¤ãƒˆãƒ« / æŠœç²‹</th>
            <th>ãƒªãƒ³ã‚¯</th>
          </tr>
        </thead>
        <tbody>
          {% for m in result.plagiarism_matches %}
            <tr>
              <td>{{ m.similarity|default_if_none:"-"|floatformat:1 }} / 100</td>
              <td>
                {{ m.title|default_if_none:"(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)" }}<br />
                <small class="text-muted">{{ m.snippet|default_if_none:"" }}</small>
              </td>
              <td>
                {% if m.url %}
                  <a href="{{ m.url }}" target="_blank" rel="noopener noreferrer">
                    é–‹ã
                  </a>
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="mt-3">é¡ä¼¼æ–‡ç« ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚</p>
    {% endif %}
  </div>

  {# ã“ã“ã‹ã‚‰ä¸‹ã¯ FastAPI ç”Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚µãƒãƒªè¡¨ç¤ºï¼ˆå¿…è¦ãªã‚‰ï¼‰ #}
  {% with raw=result.plagiarism_raw %}
    {% if raw %}
      <div class="card mt-4">
        <h2>Plagiarism API ç”Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆä¸€éƒ¨ï¼‰</h2>
        <pre style="white-space: pre-wrap; word-break: break-all;">
{{ raw|safe }}
        </pre>
      </div>
    {% endif %}
  {% endwith %}

  {% with moderation=result.moderation %}
    {% if moderation %}
      <div class="card mt-4">
        <h2>ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è©³ç´°</h2>
        <p>
          <strong>flagged:</strong>
          {{ moderation.flagged|yesno:"Yes,No" }}
        </p>
        {% if moderation.categories %}
          <table class="table mt-2">
            <thead>
              <tr>
                <th>ã‚«ãƒ†ã‚´ãƒª</th>
                <th>ã‚¹ã‚³ã‚¢</th>
              </tr>
            </thead>
            <tbody>
              {% for cat in moderation.categories %}
                <tr>
                  <td>{{ cat.name }}</td>
                  <td>{{ cat.score|default_if_none:"-"|floatformat:2 }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
      </div>
    {% endif %}
  {% endwith %}

  {% if extra and extra.debug %}
    <div class="card mt-4">
      <h2>ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h2>
      <pre style="white-space: pre-wrap; word-break: break-all;">{{ extra.debug }}</pre>
    </div>
  {% endif %}

  <div class="card mt-4">
    <h2>ãƒã‚§ãƒƒã‚¯ãƒ­ã‚°</h2>
    <p class="text-muted">
      â€» Django å´ã®ãƒ­ã‚°ç®¡ç†ç”»é¢ã‚„ä¸€è¦§ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€éå»ã®ãƒã‚§ãƒƒã‚¯çµæœã‚’å‚ç…§ã§ãã¾ã™ã€‚
    </p>
  </div>
{% endif %}

{# FastAPI å´ã® JSON ã‚’ãã®ã¾ã¾ dump ã—ã¦ãŠããŸã„å ´åˆã®ä¾‹ï¼ˆç®¡ç†è€…å‘ã‘ï¼‰ #}
{% if raw_payload_json %}
  <div class="card mt-4">
    <h2>RAW ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰</h2>
    <pre style="white-space: pre-wrap; word-break: break-all;">{{ raw_payload_json }}</pre>
  </div>
{% endif %}
{% endblock %}
